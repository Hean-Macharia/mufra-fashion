{% extends "base.html" %}

{% block title %}Add Product - Admin{% endblock %}

{% block content %}
<div class="container-fluid py-4">
    <div class="row">
        <!-- Sidebar (same as dashboard) -->
        <div class="col-md-3 col-lg-2 px-0">
            <div class="admin-sidebar">
                <div class="d-flex flex-column p-3">
                    <h4 class="mb-4">Admin Panel</h4>
                    <ul class="nav flex-column mb-auto">
                        <li class="nav-item">
                            <a class="admin-nav-link" href="{{ url_for('admin_dashboard') }}">
                                <i class="fas fa-tachometer-alt me-2"></i> Dashboard
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="admin-nav-link" href="{{ url_for('admin_products') }}">
                                <i class="fas fa-box me-2"></i> Products
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="admin-nav-link active" href="{{ url_for('add_product') }}">
                                <i class="fas fa-plus me-2"></i> Add Product
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
        
        <!-- Main Content -->
        <div class="col-md-9 col-lg-10">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h1>Add New Product</h1>
                <a href="{{ url_for('admin_products') }}" class="btn btn-outline-primary">
                    <i class="fas fa-arrow-left me-2"></i> Back to Products
                </a>
            </div>
            
            <div class="card">
                <div class="card-body">
                    <form method="POST" action="{{ url_for('add_product') }}" enctype="multipart/form-data">
                        <div class="row">
                            <!-- Left Column -->
                            <div class="col-lg-8">
                                <div class="mb-3">
                                    <label class="form-label">Product Name *</label>
                                    <input type="text" class="form-control" name="name" required>
                                </div>
                                
                                <div class="mb-3">
                                    <label class="form-label">Description *</label>
                                    <textarea class="form-control" name="description" rows="4" required></textarea>
                                </div>
                                
                                <div class="row mb-3">
                                    <div class="col-md-6">
                                        <label class="form-label">Price (KES) *</label>
                                        <input type="number" class="form-control" name="price" step="0.01" min="0" required>
                                    </div>
                                    <div class="col-md-6">
                                        <label class="form-label">Stock Quantity *</label>
                                        <input type="number" class="form-control" name="stock" min="0" required>
                                    </div>
                                </div>
                                
                                <div class="row mb-3">
                                    <div class="col-md-6">
                                        <label class="form-label">Category *</label>
                                        <select class="form-select" name="category" required>
                                            <option value="">Select Category</option>
                                            {% for category in categories %}
                                            <option value="{{ category.name }}">{{ category.name }}</option>
                                            {% endfor %}
                                        </select>
                                    </div>
                                    <div class="col-md-6">
                                        <label class="form-label">Subcategory</label>
                                        <input type="text" class="form-control" name="subcategory" 
                                               placeholder="e.g., Sports, Casual, Formal">
                                    </div>
                                </div>
                                
                                <div class="row mb-3">
                                    <div class="col-md-6">
                                        <label class="form-label">Condition *</label>
                                        <select class="form-select" name="condition" required>
                                            <option value="New">New</option>
                                            <option value="Second Hand">Second Hand</option>
                                        </select>
                                    </div>
                                </div>
                                
                                <!-- Sizes -->
                                <div class="mb-3">
                                    <label class="form-label">Available Sizes</label>
                                    <div class="row" id="sizes-container">
                                        <div class="col-auto">
                                            <div class="form-check form-check-inline">
                                                <input class="form-check-input" type="checkbox" name="sizes[]" value="S" id="sizeS">
                                                <label class="form-check-label" for="sizeS">S</label>
                                            </div>
                                        </div>
                                        <div class="col-auto">
                                            <div class="form-check form-check-inline">
                                                <input class="form-check-input" type="checkbox" name="sizes[]" value="M" id="sizeM">
                                                <label class="form-check-label" for="sizeM">M</label>
                                            </div>
                                        </div>
                                        <div class="col-auto">
                                            <div class="form-check form-check-inline">
                                                <input class="form-check-input" type="checkbox" name="sizes[]" value="L" id="sizeL">
                                                <label class="form-check-label" for="sizeL">L</label>
                                            </div>
                                        </div>
                                        <div class="col-auto">
                                            <div class="form-check form-check-inline">
                                                <input class="form-check-input" type="checkbox" name="sizes[]" value="XL" id="sizeXL">
                                                <label class="form-check-label" for="sizeXL">XL</label>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="mt-2">
                                        <small class="text-muted">Or add custom sizes:</small>
                                        <div class="input-group mt-1">
                                            <input type="text" class="form-control" id="custom-size" placeholder="e.g., 8, 9, 10">
                                            <button type="button" class="btn btn-outline-secondary" onclick="addCustomSizes()">Add</button>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Colors -->
                                <div class="mb-3">
                                    <label class="form-label">Available Colors</label>
                                    <div class="row" id="colors-container">
                                        <div class="col-auto">
                                            <div class="form-check form-check-inline">
                                                <input class="form-check-input" type="checkbox" name="colors[]" value="Blue" id="colorBlue">
                                                <label class="form-check-label" for="colorBlue">Blue</label>
                                            </div>
                                        </div>
                                        <div class="col-auto">
                                            <div class="form-check form-check-inline">
                                                <input class="form-check-input" type="checkbox" name="colors[]" value="White" id="colorWhite">
                                                <label class="form-check-label" for="colorWhite">White</label>
                                            </div>
                                        </div>
                                        <div class="col-auto">
                                            <div class="form-check form-check-inline">
                                                <input class="form-check-input" type="checkbox" name="colors[]" value="Black" id="colorBlack">
                                                <label class="form-check-label" for="colorBlack">Black</label>
                                            </div>
                                        </div>
                                        <div class="col-auto">
                                            <div class="form-check form-check-inline">
                                                <input class="form-check-input" type="checkbox" name="colors[]" value="Red" id="colorRed">
                                                <label class="form-check-label" for="colorRed">Red</label>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="mt-2">
                                        <small class="text-muted">Or add custom colors:</small>
                                        <div class="input-group mt-1">
                                            <input type="text" class="form-control" id="custom-color" placeholder="e.g., Navy, Gray, Beige">
                                            <button type="button" class="btn btn-outline-secondary" onclick="addCustomColors()">Add</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Right Column -->
                            <div class="col-lg-4">
                                <!-- Image Upload -->
                                <div class="mb-4">
                                    <label class="form-label">Product Image *</label>
                                    <div class="border rounded p-3 text-center">
                                        <img id="image-preview" src="https://via.placeholder.com/300x200?text=Product+Image" 
                                             class="img-fluid mb-3" style="max-height: 200px;">
                                        <input type="file" class="form-control image-upload" name="image" 
                                               accept="image/*" onchange="previewImage(this)" required>
                                        <small class="text-muted d-block mt-2">
                                            Recommended: 800x600px, max 2MB
                                        </small>
                                    </div>
                                </div>
                                
                                <!-- Additional Settings -->
                                <div class="card">
                                    <div class="card-body">
                                        <h6 class="card-title">Additional Settings</h6>
                                        
                                        <div class="form-check form-switch mb-3">
                                            <input class="form-check-input" type="checkbox" name="featured" id="featured">
                                            <label class="form-check-label" for="featured">
                                                Featured Product
                                            </label>
                                        </div>
                                        
                                        <div class="mb-3">
                                            <label class="form-label">Initial Rating</label>
                                            <select class="form-select" name="rating">
                                                <option value="0">No rating</option>
                                                <option value="1">1 Star</option>
                                                <option value="2">2 Stars</option>
                                                <option value="3">3 Stars</option>
                                                <option value="4" selected>4 Stars</option>
                                                <option value="5">5 Stars</option>
                                            </select>
                                        </div>
                                        
                                        <div class="mb-3">
                                            <label class="form-label">Initial Reviews Count</label>
                                            <input type="number" class="form-control" name="reviews_count" value="0" min="0">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Form Actions -->
                        <div class="mt-4">
                            <div class="d-flex justify-content-between">
                                <button type="reset" class="btn btn-outline-secondary">
                                    <i class="fas fa-redo me-2"></i> Reset
                                </button>
                                <button type="submit" class="btn btn-primary">
                                    <i class="fas fa-save me-2"></i> Save Product
                                </button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>{% extends "base.html" %}

{% block title %}Edit Product - Admin{% endblock %}

{% block content %}
<div class="container-fluid py-4">
    <div class="row">
        <!-- Sidebar (same as dashboard) -->
        <div class="col-md-3 col-lg-2 px-0">
            <div class="admin-sidebar">
                <div class="d-flex flex-column p-3">
                    <h4 class="mb-4">Admin Panel</h4>
                    <ul class="nav flex-column mb-auto">
                        <li class="nav-item">
                            <a class="admin-nav-link" href="{{ url_for('admin_dashboard') }}">
                                <i class="fas fa-tachometer-alt me-2"></i> Dashboard
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="admin-nav-link" href="{{ url_for('admin_products') }}">
                                <i class="fas fa-box me-2"></i> Products
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="admin-nav-link active" href="{{ url_for('add_product') }}">
                                <i class="fas fa-plus me-2"></i> Add Product
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="admin-nav-link" href="{{ url_for('admin_orders') }}">
                                <i class="fas fa-shopping-bag me-2"></i> Orders
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
        
        <!-- Main Content -->
        <div class="col-md-9 col-lg-10">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h1>Edit Product</h1>
                <a href="{{ url_for('admin_products') }}" class="btn btn-outline-primary">
                    <i class="fas fa-arrow-left me-2"></i> Back to Products
                </a>
            </div>
            
            <div class="card">
                <div class="card-body">
                    <form method="POST" action="{{ url_for('edit_product', product_id=product._id) }}" enctype="multipart/form-data">
                        <div class="row">
                            <!-- Left Column -->
                            <div class="col-lg-8">
                                <div class="mb-3">
                                    <label class="form-label">Product Name *</label>
                                    <input type="text" class="form-control" name="name" 
                                           value="{{ product.name }}" required>
                                </div>
                                
                                <div class="mb-3">
                                    <label class="form-label">Description *</label>
                                    <textarea class="form-control" name="description" rows="4" required>{{ product.description }}</textarea>
                                </div>
                                
                                <!-- Similar to add_product.html with pre-filled values -->
                                <!-- Add all other fields with {{ product.field_name }} values -->
                                
                            </div>
                            
                            <!-- Right Column -->
                            <div class="col-lg-4">
                                <!-- Image Upload with current image preview -->
                                <div class="mb-4">
                                    <label class="form-label">Product Image</label>
                                    <div class="border rounded p-3 text-center">
                                        {% if product.image %}
                                        <img id="image-preview" 
                                             src="{{ url_for('static', filename='uploads/' + product.image) }}" 
                                             class="img-fluid mb-3" style="max-height: 200px;">
                                        {% else %}
                                        <img id="image-preview" 
                                             src="https://via.placeholder.com/300x200?text=Product+Image" 
                                             class="img-fluid mb-3" style="max-height: 200px;">
                                        {% endif %}
                                        <input type="file" class="form-control image-upload" name="image" 
                                               accept="image/*" onchange="previewImage(this)">
                                        <small class="text-muted d-block mt-2">
                                            Leave empty to keep current image
                                        </small>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Form Actions -->
                        <div class="mt-4">
                            <div class="d-flex justify-content-between">
                                <a href="{{ url_for('delete_product', product_id=product._id) }}" 
                                   class="btn btn-danger"
                                   onclick="return confirm('Are you sure you want to delete this product?')">
                                    <i class="fas fa-trash me-2"></i> Delete
                                </a>
                                <button type="submit" class="btn btn-primary">
                                    <i class="fas fa-save me-2"></i> Update Product
                                </button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Include JavaScript from add_product.html -->
{% block extra_js %}
<script>
function previewImage(input) {
    if (input.files && input.files[0]) {
        const reader = new FileReader();
        reader.onload = function(e) {
            document.getElementById('image-preview').src = e.target.result;
        }
        reader.readAsDataURL(input.files[0]);
    }
}

function addCustomSizes() {
    const input = document.getElementById('custom-size');
    const sizes = input.value.split(',').map(s => s.trim()).filter(s => s);
    
    sizes.forEach(size => {
        if (!size) return;
        
        const container = document.getElementById('sizes-container');
        const col = document.createElement('div');
        col.className = 'col-auto';
        
        const checkId = 'size' + size.replace(/\s+/g, '');
        col.innerHTML = `
            <div class="form-check form-check-inline">
                <input class="form-check-input" type="checkbox" name="sizes[]" value="${size}" id="${checkId}" checked>
                <label class="form-check-label" for="${checkId}">${size}</label>
            </div>
        `;
        
        container.appendChild(col);
    });
    
    input.value = '';
}

function addCustomColors() {
    const input = document.getElementById('custom-color');
    const colors = input.value.split(',').map(c => c.trim()).filter(c => c);
    
    colors.forEach(color => {
        if (!color) return;
        
        const container = document.getElementById('colors-container');
        const col = document.createElement('div');
        col.className = 'col-auto';
        
        const checkId = 'color' + color.replace(/\s+/g, '');
        col.innerHTML = `
            <div class="form-check form-check-inline">
                <input class="form-check-input" type="checkbox" name="colors[]" value="${color}" id="${checkId}" checked>
                <label class="form-check-label" for="${checkId}">${color}</label>
            </div>
        `;
        
        container.appendChild(col);
    });
    
    input.value = '';
}

// Form validation
document.querySelector('form').addEventListener('submit', function(e) {
    const price = document.querySelector('input[name="price"]').value;
    if (price <= 0) {
        e.preventDefault();
        alert('Price must be greater than 0');
        return false;
    }
    
    const stock = document.querySelector('input[name="stock"]').value;
    if (stock < 0) {
        e.preventDefault();
        alert('Stock cannot be negative');
        return false;
    }
});
</script>
{% endblock %}
{% endblock %}
</div>

{% block extra_js %}

{% endblock %}
{% endblock %}