{% extends "admin/base.html" %}

{% block title %}Add New Product - Admin Panel{% endblock %}
{% block page_title %}Add New Product{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="row">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h1>Add New Product</h1>
                <a href="{{ url_for('admin_products') }}" class="btn btn-outline-secondary">
                    <i class="fas fa-arrow-left me-2"></i> Back to Products
                </a>
            </div>

            <div class="card">
                <div class="card-body">
                    <form method="POST" action="{{ url_for('add_product') }}" enctype="multipart/form-data">
                        <!-- Product Name -->
                        <div class="mb-3">
                            <label for="name" class="form-label">Product Name *</label>
                            <input type="text" class="form-control" id="name" name="name" required 
                                   placeholder="Enter product name">
                        </div>

                        <!-- Description -->
                        <div class="mb-3">
                            <label for="description" class="form-label">Description *</label>
                            <textarea class="form-control" id="description" name="description" rows="3" required
                                      placeholder="Enter product description"></textarea>
                        </div>

                        <!-- Price -->
                        <div class="mb-3">
                            <label for="price" class="form-label">Price (KES) *</label>
                            <input type="number" class="form-control" id="price" name="price" step="0.01" min="0" required
                                   placeholder="0.00">
                        </div>

                        <!-- Category -->
                        <div class="mb-3">
                            <label for="category" class="form-label">Category *</label>
                            <select class="form-control" id="category" name="category" required>
                                <option value="">Select category</option>
                                {% if categories %}
                                    {% for category in categories %}
                                    <option value="{{ category.name }}">{{ category.name }}</option>
                                    {% endfor %}
                                {% else %}
                                    <option value="Shoes">Shoes</option>
                                    <option value="Clothes">Clothes</option>
                                    <option value="New">New</option>
                                    <option value="Second Hand">Second Hand</option>
                                {% endif %}
                            </select>
                        </div>

                        <!-- Subcategory -->
                        <div class="mb-3">
                            <label for="subcategory" class="form-label">Subcategory</label>
                            <input type="text" class="form-control" id="subcategory" name="subcategory"
                                   placeholder="e.g., Sports, Casual, Tops, Bottoms">
                        </div>

                        <!-- Condition -->
                        <div class="mb-3">
                            <label for="condition" class="form-label">Condition *</label>
                            <select class="form-control" id="condition" name="condition" required>
                                <option value="New">New</option>
                                <option value="Second Hand">Second Hand</option>
                                <option value="Used">Used</option>
                                <option value="Refurbished">Refurbished</option>
                            </select>
                        </div>

                        <!-- Stock -->
                        <div class="mb-3">
                            <label for="stock" class="form-label">Stock Quantity *</label>
                            <input type="number" class="form-control" id="stock" name="stock" min="0" required
                                   placeholder="Enter stock quantity">
                        </div>

                        <!-- Sizes -->
                        <div class="mb-3">
                            <label class="form-label">Available Sizes</label>
                            <div class="row">
                                {% for size in ['S', 'M', 'L', 'XL', 'XXL', '6', '7', '8', '9', '10', '11', '12', '28', '30', '32', '34', '36', '38', '40'] %}
                                <div class="col-3 col-md-2 mb-2">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" name="sizes[]" value="{{ size }}" id="size_{{ size }}">
                                        <label class="form-check-label" for="size_{{ size }}">
                                            {{ size }}
                                        </label>
                                    </div>
                                </div>
                                {% endfor %}
                            </div>
                        </div>

                        <!-- Colors -->
                        <div class="mb-3">
                            <label class="form-label">Available Colors</label>
                            <div class="row">
                                {% for color in ['Black', 'White', 'Blue', 'Red', 'Green', 'Yellow', 'Gray', 'Brown', 'Navy', 'Pink', 'Purple', 'Orange', 'Multi'] %}
                                <div class="col-3 col-md-2 mb-2">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" name="colors[]" value="{{ color }}" id="color_{{ color }}">
                                        <label class="form-check-label" for="color_{{ color }}">
                                            {{ color }}
                                        </label>
                                    </div>
                                </div>
                                {% endfor %}
                            </div>
                        </div>

                        <!-- Image Upload -->
                        <div class="mb-3">
                            <label for="image" class="form-label">Product Image</label>
                            <input type="file" class="form-control" id="image" name="image" accept="image/*">
                            <small class="text-muted">Upload a product image (PNG, JPG, JPEG, GIF). Max size: 16MB</small>
                        </div>

                        <!-- OR Image URL -->
                        <div class="mb-3">
                            <label for="image_url" class="form-label">Or Image URL</label>
                            <input type="url" class="form-control" id="image_url" name="image_url"
                                   placeholder="https://example.com/image.jpg">
                            <small class="text-muted">Enter a direct image URL if you don't want to upload a file</small>
                        </div>

                        <!-- Featured -->
                        <div class="mb-3 form-check">
                            <input type="checkbox" class="form-check-input" id="featured" name="featured" value="1">
                            <label class="form-check-label" for="featured">
                                Mark as featured product
                            </label>
                        </div>

                        <!-- Submit Button -->
                        <div class="d-grid gap-2">
                            <button type="submit" class="btn btn-primary btn-lg">
                                <i class="fas fa-plus me-2"></i> Add Product
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Image Preview Script -->
<script>
document.getElementById('image').addEventListener('change', function(e) {
    const file = e.target.files[0];
    if (file) {
        const reader = new FileReader();
        reader.onload = function(e) {
            // Create preview if it doesn't exist
            let preview = document.getElementById('image-preview');
            if (!preview) {
                preview = document.createElement('div');
                preview.id = 'image-preview';
                preview.className = 'mt-3 text-center';
                document.querySelector('label[for="image"]').after(preview);
            }
            preview.innerHTML = `
                <img src="${e.target.result}" class="img-thumbnail" style="max-width: 200px; max-height: 200px;">
                <p class="mt-2 mb-0"><small>Image Preview</small></p>
            `;
        }
        reader.readAsDataURL(file);
    }
});
</script>
{% endblock %}