{% extends "base.html" %}

{% block title %}Order Confirmation - MUFRA FASHIONS{% endblock %}

{% block content %}
<div class="confirmation-container">
    <div class="container">
        <!-- Success Header -->
        <div class="success-header">
            <div class="success-icon">
                <i class="fas fa-check-circle"></i>
            </div>
            <h1 class="page-title">Order Confirmed!</h1>
            <p class="success-message">Thank you for your order. Your order number is:</p>
            <div class="order-id">{{ order._id }}</div>
            <p class="order-date">Placed on {{ order.created_at.strftime('%B %d, %Y at %I:%M %p') }}</p>
        </div>
        
        <!-- Order Summary -->
        <div class="confirmation-card">
            <h2 class="card-title">Order Summary</h2>
            
            <!-- Order Details -->
            <div class="order-details-grid">
                <div class="detail-section">
                    <h3><i class="fas fa-truck"></i> Shipping Details</h3>
                    <div class="detail-content">
                        <p><strong>Name:</strong> {{ order.shipping_address.name }}</p>
                        <p><strong>Phone:</strong> {{ order.shipping_address.phone }}</p>
                        <p><strong>Address:</strong> {{ order.shipping_address.address }}</p>
                        <p><strong>City:</strong> {{ order.shipping_address.city }}</p>
                        <p><strong>Region:</strong> {{ order.shipping_address.region }}</p>
                    </div>
                </div>
                
                <div class="detail-section">
                    <h3><i class="fas fa-credit-card"></i> Payment Details</h3>
                    <div class="detail-content">
                        <p><strong>Method:</strong> 
                            {% if order.payment_method == 'mpesa' %}
                                <span class="payment-method"><i class="fab fa-cc-m-pesa"></i> M-Pesa</span>
                            {% elif order.payment_method == 'airtel' %}
                                <span class="payment-method"><i class="fas fa-mobile-alt"></i> Airtel Money</span>
                            {% else %}
                                <span class="payment-method"><i class="fas fa-money-bill-wave"></i> Cash on Delivery</span>
                            {% endif %}
                        </p>
                        <p><strong>Payment Number:</strong> {{ order.payment_number }}</p>
                        <p><strong>Status:</strong> 
                            <span class="status-badge status-{{ order.status }}">
                                {{ order.status|title }}
                            </span>
                        </p>
                    </div>
                </div>
            </div>
            
            <!-- Order Items -->
            <div class="order-items-section">
                <h3><i class="fas fa-box"></i> Order Items</h3>
                <div class="order-items">
                    {% for item in order.items %}
                    <div class="order-item">
                        <div class="item-image">
                            <img src="https://via.placeholder.com/80x80?text=Product" alt="Product">
                        </div>
                        <div class="item-details">
                            <h4>{{ item.name }}</h4>
                            <div class="item-meta">
                                <span class="quantity">Quantity: {{ item.quantity }}</span>
                                {% if item.size or item.color %}
                                <span class="variants">
                                    {% if item.size %}{{ item.size }}{% endif %}
                                    {% if item.color %} â€¢ {{ item.color }}{% endif %}
                                </span>
                                {% endif %}
                            </div>
                        </div>
                        <div class="item-price">KSh {{ "%.2f"|format(item.item_total) }}</div>
                    </div>
                    {% endfor %}
                </div>
            </div>
            
            <!-- Price Breakdown -->
            <div class="price-breakdown">
                <div class="price-row">
                    <span>Subtotal</span>
                    <span>KSh {{ "%.2f"|format(order.cart_total) }}</span>
                </div>
                <div class="price-row">
                    <span>Delivery Fee</span>
                    <span>KSh {{ "%.2f"|format(order.delivery_fee) }}</span>
                </div>
                <div class="price-divider"></div>
                <div class="price-row total">
                    <span>Total Amount</span>
                    <span class="total-amount">KSh {{ "%.2f"|format(order.total_amount) }}</span>
                </div>
            </div>
        </div>
        
        <!-- Next Steps -->
        <div class="next-steps">
            <h2 class="section-title">What Happens Next?</h2>
            <div class="steps-timeline">
                <div class="step">
                    <div class="step-icon">
                        <i class="fas fa-clipboard-check"></i>
                    </div>
                    <div class="step-content">
                        <h3>Order Processing</h3>
                        <p>We're preparing your order for shipping.</p>
                        <span class="step-time">Estimated: 24 hours</span>
                    </div>
                </div>
                
                <div class="step">
                    <div class="step-icon">
                        <i class="fas fa-shipping-fast"></i>
                    </div>
                    <div class="step-content">
                        <h3>Shipping</h3>
                        <p>Your order will be shipped to your address.</p>
                        <span class="step-time">Estimated: 3-5 business days</span>
                    </div>
                </div>
                
                <div class="step">
                    <div class="step-icon">
                        <i class="fas fa-home"></i>
                    </div>
                    <div class="step-content">
                        <h3>Delivery</h3>
                        <p>Your order will be delivered to your doorstep.</p>
                        <span class="step-time">Estimated: 3-5 business days</span>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Actions -->
        <div class="confirmation-actions">
            <div class="action-buttons">
                <a href="{{ url_for('home') }}" class="btn btn-outline">
                    <i class="fas fa-home"></i> Back to Home
                </a>
                <a href="{{ url_for('categories') }}" class="btn btn-primary">
                    <i class="fas fa-shopping-bag"></i> Continue Shopping
                </a>
                <button class="btn btn-secondary" onclick="printOrder()">
                    <i class="fas fa-print"></i> Print Receipt
                </button>
            </div>
            
            <div class="support-info">
                <h3><i class="fas fa-headset"></i> Need Help?</h3>
                <p>Contact our customer support at <strong>+254 712 345 678</strong> or email <strong>support@mufrafashions.com</strong></p>
                <p>You can also track your order using your order number.</p>
            </div>
        </div>
    </div>
</div>

<style>
/* Confirmation Page Styles */
.confirmation-container {
    padding: 40px 0;
    background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
    min-height: 100vh;
}

/* Success Header */
.success-header {
    text-align: center;
    margin-bottom: 40px;
}

.success-icon {
    font-size: 5rem;
    color: #28a745;
    margin-bottom: 20px;
    animation: successBounce 0.6s ease-out;
}

@keyframes successBounce {
    0%, 20%, 50%, 80%, 100% {
        transform: translateY(0);
    }
    40% {
        transform: translateY(-30px);
    }
    60% {
        transform: translateY(-15px);
    }
}

.page-title {
    font-size: 2.5rem;
    color: #333;
    margin-bottom: 15px;
}

.success-message {
    font-size: 1.2rem;
    color: #666;
    margin-bottom: 10px;
}

.order-id {
    font-size: 1.5rem;
    font-weight: 700;
    color: #667eea;
    background: white;
    padding: 10px 30px;
    border-radius: 50px;
    display: inline-block;
    margin: 15px auto;
    box-shadow: 0 5px 15px rgba(0,0,0,0.1);
}

.order-date {
    color: #888;
    font-size: 1rem;
}

/* Confirmation Card */
.confirmation-card {
    background: white;
    border-radius: 20px;
    padding: 40px;
    box-shadow: 0 10px 40px rgba(0,0,0,0.1);
    margin-bottom: 40px;
}

.card-title {
    font-size: 2rem;
    color: #333;
    margin-bottom: 30px;
    padding-bottom: 15px;
    border-bottom: 3px solid #667eea;
}

/* Order Details Grid */
.order-details-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 30px;
    margin-bottom: 40px;
}

.detail-section {
    background: #f8f9fa;
    border-radius: 15px;
    padding: 25px;
}

.detail-section h3 {
    display: flex;
    align-items: center;
    gap: 10px;
    font-size: 1.3rem;
    color: #333;
    margin-bottom: 20px;
    padding-bottom: 10px;
    border-bottom: 2px solid #eaeaea;
}

.detail-section h3 i {
    color: #667eea;
}

.detail-content p {
    margin-bottom: 10px;
    color: #555;
}

.detail-content strong {
    color: #333;
    min-width: 100px;
    display: inline-block;
}

.payment-method {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    font-weight: 600;
}

.status-badge {
    padding: 6px 15px;
    border-radius: 20px;
    font-size: 0.9rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.status-pending {
    background: #fff3cd;
    color: #856404;
}

.status-processing {
    background: #cce5ff;
    color: #004085;
}

.status-shipped {
    background: #d4edda;
    color: #155724;
}

.status-delivered {
    background: #d1ecf1;
    color: #0c5460;
}

/* Order Items */
.order-items-section {
    margin-bottom: 30px;
}

.order-items-section h3 {
    display: flex;
    align-items: center;
    gap: 10px;
    font-size: 1.3rem;
    color: #333;
    margin-bottom: 20px;
}

.order-items {
    background: #f8f9fa;
    border-radius: 15px;
    padding: 20px;
}

.order-item {
    display: grid;
    grid-template-columns: auto 1fr auto;
    gap: 20px;
    align-items: center;
    padding: 15px;
    background: white;
    border-radius: 10px;
    margin-bottom: 10px;
}

.item-image {
    width: 80px;
    height: 80px;
    border-radius: 10px;
    overflow: hidden;
    border: 2px solid #eee;
}

.item-image img {
    width: 100%;
    height: 100%;
    object-fit: cover;
}

.item-details h4 {
    margin: 0 0 8px 0;
    font-size: 1.1rem;
    color: #333;
}

.item-meta {
    display: flex;
    gap: 15px;
    font-size: 0.9rem;
    color: #666;
}

.item-price {
    font-size: 1.2rem;
    font-weight: 700;
    color: #667eea;
}

/* Price Breakdown */
.price-breakdown {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    padding: 25px;
    border-radius: 15px;
}

.price-row {
    display: flex;
    justify-content: space-between;
    margin-bottom: 15px;
    font-size: 1.1rem;
}

.price-row.total {
    font-size: 1.5rem;
    font-weight: 700;
    margin-top: 10px;
}

.total-amount {
    font-size: 1.8rem;
}

.price-divider {
    height: 2px;
    background: rgba(255,255,255,0.3);
    margin: 20px 0;
}

/* Next Steps */
.next-steps {
    margin-bottom: 40px;
}

.section-title {
    font-size: 2rem;
    color: #333;
    text-align: center;
    margin-bottom: 40px;
}

.steps-timeline {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 30px;
}

.step {
    background: white;
    border-radius: 15px;
    padding: 25px;
    box-shadow: 0 5px 20px rgba(0,0,0,0.1);
    display: flex;
    gap: 20px;
    align-items: flex-start;
    transition: transform 0.3s;
}

.step:hover {
    transform: translateY(-5px);
}

.step-icon {
    width: 60px;
    height: 60px;
    background: #f0f4ff;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.5rem;
    color: #667eea;
}

.step-content h3 {
    margin: 0 0 10px 0;
    color: #333;
    font-size: 1.2rem;
}

.step-content p {
    margin: 0 0 10px 0;
    color: #666;
    font-size: 0.95rem;
}

.step-time {
    font-size: 0.85rem;
    color: #888;
    font-weight: 500;
}

/* Confirmation Actions */
.confirmation-actions {
    text-align: center;
}

.action-buttons {
    display: flex;
    justify-content: center;
    gap: 20px;
    margin-bottom: 40px;
    flex-wrap: wrap;
}

.action-buttons .btn {
    min-width: 200px;
    padding: 15px 30px;
    font-size: 1.1rem;
}

.support-info {
    background: white;
    border-radius: 15px;
    padding: 30px;
    box-shadow: 0 5px 20px rgba(0,0,0,0.1);
    max-width: 600px;
    margin: 0 auto;
}

.support-info h3 {
    display: flex;
    align-items: center;
    gap: 10px;
    justify-content: center;
    font-size: 1.3rem;
    color: #333;
    margin-bottom: 15px;
}

.support-info h3 i {
    color: #667eea;
}

.support-info p {
    color: #666;
    margin-bottom: 10px;
}

.support-info strong {
    color: #667eea;
}

/* Responsive Design */
@media (max-width: 768px) {
    .confirmation-card {
        padding: 20px;
    }
    
    .order-details-grid {
        grid-template-columns: 1fr;
    }
    
    .steps-timeline {
        grid-template-columns: 1fr;
    }
    
    .action-buttons {
        flex-direction: column;
    }
    
    .action-buttons .btn {
        width: 100%;
    }
    
    .order-item {
        grid-template-columns: 1fr;
        text-align: center;
    }
    
    .item-meta {
        justify-content: center;
    }
}

/* Print Styles */
@media print {
    .confirmation-container {
        background: white;
        padding: 0;
    }
    
    .success-header {
        margin-bottom: 20px;
    }
    
    .confirmation-card {
        box-shadow: none;
        margin-bottom: 20px;
    }
    
    .action-buttons,
    .next-steps {
        display: none;
    }
    
    .support-info {
        box-shadow: none;
        border: 2px solid #eee;
    }
}
</style>

<script>
// Print order function
function printOrder() {
    window.print();
}

// Share order function
function shareOrder() {
    if (navigator.share) {
        navigator.share({
            title: 'My Order from MUFRA FASHIONS',
            text: `I just placed an order from MUFRA FASHIONS! Order ID: ${document.querySelector('.order-id').textContent}`,
            url: window.location.href
        })
        .then(() => console.log('Order shared successfully'))
        .catch(error => console.log('Error sharing:', error));
    } else {
        // Fallback: Copy to clipboard
        const orderId = document.querySelector('.order-id').textContent;
        navigator.clipboard.writeText(`Order ID: ${orderId}`);
        showToast('Order ID copied to clipboard!', 'success');
    }
}

function showToast(message, type = 'success') {
    const toast = document.createElement('div');
    toast.className = `toast toast-${type}`;
    toast.innerHTML = `
        <div class="toast-content">
            <i class="fas ${type === 'success' ? 'fa-check-circle' : 
                          type === 'error' ? 'fa-exclamation-circle' : 
                          'fa-info-circle'}"></i>
            <span>${message}</span>
        </div>
        <button class="toast-close" onclick="this.parentElement.remove()">
            <i class="fas fa-times"></i>
        </button>
    `;
    
    toast.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        background: ${type === 'success' ? '#d4edda' : 
                     type === 'error' ? '#f8d7da' : 
                     '#d1ecf1'};
        color: ${type === 'success' ? '#155724' : 
                type === 'error' ? '#721c24' : 
                '#0c5460'};
        padding: 1rem 1.5rem;
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: space-between;
        min-width: 300px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        z-index: 9999;
        animation: slideInRight 0.3s ease-out;
    `;
    
    document.body.appendChild(toast);
    
    setTimeout(() => {
        if (toast.parentNode) {
            toast.remove();
        }
    }, 5000);
}

// Update order status animation
document.addEventListener('DOMContentLoaded', function() {
    // Animate price breakdown
    const priceRows = document.querySelectorAll('.price-row');
    priceRows.forEach((row, index) => {
        row.style.opacity = '0';
        row.style.transform = 'translateY(20px)';
        
        setTimeout(() => {
            row.style.transition = 'all 0.5s ease-out';
            row.style.opacity = '1';
            row.style.transform = 'translateY(0)';
        }, 100 * index);
    });
    
    // Add animation to steps
    const steps = document.querySelectorAll('.step');
    steps.forEach((step, index) => {
        step.style.opacity = '0';
        step.style.transform = 'translateX(-20px)';
        
        setTimeout(() => {
            step.style.transition = 'all 0.5s ease-out';
            step.style.opacity = '1';
            step.style.transform = 'translateX(0)';
        }, 200 * index);
    });
});
</script>
{% endblock %}